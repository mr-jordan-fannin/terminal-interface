<!DOCTYPE html>
<html lang="en">

<head>
    <meta content="text/html">
    <meta charset="utf-8">
    <style>
        @font-face {
            font-family: "MorePerfectDOSVGA";
            src: local(MorePerfectDOSVGA);
        }
        html {
            background-color: gray;
            font-family: "MorePerfectDOSVGA", Arial, sans-serif;
        }
        #display {
            padding: 20px;
        }
        #screen {
            background-color: black;
            color: lime;
            float: left;
            margin: 20px;
            height: 480px;
            width: 640px;
            overflow-y: auto;
        }
        #screen:before {
            content: '';
            position: absolute;
            font-size: 1px;
            width: 640px;
            height: 2px;
            background: lime;
            opacity: .2;
            animation: vline 5s linear infinite;
        }
        @keyframes vline {
            0%   { top: 28px; }
            100% { top: 504px; }
        }
        .line {
            font-size: 12pt;
            white-space: pre;
            word-wrap: break-word;
        }
    </style>
    <title>TERMINAL</title>
</head>

<body>
    <div id="screen">
        <div id="display"></div>
    </div>
</body>

<script type="application/javascript" language="javascript">

    // DISPLAY COMPONENTS
    var row = 0;
    var column = 0;
    var command = '';
    const fontColor = "lime";
    const displayColor = "black";
    const rate = 500;
    const wait = ['-','\\','|','/'];


    // SETUP
    clear();
    blinking();

    // LOOPS
    window.addEventListener('keypress', function(event) {
        keyboard(event);
    });

    // STARTING CONDITION
    function start() {
        command = "";
        column = 0;
    }

    // CURSOR
    function cursor() {
        return '<span id="cursor">â–ˆ</span>';
    }

    // PROMPT
    function prompt() {
        return '<span class="prompt">></span>';
    }

    // BLINKING ANIMATION
    function blinking() {
        setInterval(function () {
            if (document.getElementById('cursor')) {
                if (document.getElementById('cursor').style.color === displayColor) {
                    document.getElementById('cursor').style.color = fontColor;
                } else {
                    document.getElementById('cursor').style.color = displayColor;
                }
            }
        }, rate);
    }

    // ENTER COMMANDS
    function enter() {
        switch (command) {
            case 'CLEAR':
                clear();
                break;
            case 'HELP':
                help();
                break;
            case 'WAIT':
                waiter();
                break;
            default:
                post();
                break;
        }
        document.getElementById('line' + row).scrollIntoView(false);
    }

    // CLEAR DISPLAY
    function clear() {
        document.getElementById('display').innerHTML = '<div id="line0" class="line"></div>';
        document.getElementById('line0').innerHTML = prompt() + cursor();
        row = 0;
        start();
    }

    // HELP COMMAND
    function help() {
        row++;
        document.getElementById('display').innerHTML += '<div id="line' + row + '">HELP YOURSELF.</div>';
        post();
    }

    // POST TEXT
    function post() {
        row++;
        document.getElementById('display').innerHTML += '<div id="line' + row + '" class="line"></div>';
        start();
        draw();
        placeCursor();
    }

    // DRAW ROW
    function draw() {
        document.getElementById('line' + row).innerHTML = prompt() + command;
    }

    // PLACE CURSOR
    function placeCursor() {
        var newLine = prompt() + command.slice(0, column) + cursor();
        var displayView = document.getElementById('display');
        document.getElementById('line' + row).innerHTML = newLine + command.slice(column,command.length);
        displayView.scrollTop = displayView.scrollHeight;
    }

    // MAIN EVENT LOOP
    function keyboard(event) {
        switch (event.keyCode) {
            case 8:     // backspace key
                if (command.length > 0) {
                    command = command.substring(0, command.length - 1);
                }
                draw();
                placeCursor();
                break;
            case 37:    // left arrow key
                if (column > 0) {
                    column--;
                }
                placeCursor();
                break;
            case 39:    // right arrow key
                if (column < command.length) {
                    column++;
                }
                placeCursor();
                break;
            case 13:    // enter key
                draw();
                enter();
                break;
            case 38:    // up arrow key
                break;
            case 40:    // down arrow key
                break;
            default:
                if (event.keyCode === 32) { // space bar
                    command += '\xa0';
                }
                command = command.slice(0,column) + event.key.toUpperCase() + command.slice(column,command.length);
                column++;
                draw();
                placeCursor();
                break;
        }
    }

    // WAITER
    function waiter() {
        row++;
        document.getElementById('display').innerHTML += '<div id="line' + row + '"><span id="waiter"></span></div>';
        start();
        waiting();
    }

    // WAITING ANIMATION
    function waiting() {
        var i = 0;
        var waitSpin = setInterval(function () {
            if (document.getElementById('waiter')) {
                document.getElementById('waiter').innerHTML = wait[i];
                i++;
                if (i > wait.length - 1) {
                    i = 0;
                }
            } else {
                clearInterval(waitSpin);
            }
        }, rate);
    }

</script>

</html>
